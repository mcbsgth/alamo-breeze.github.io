<!doctype html>
<html lang="th">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Alamo Breeze POS System</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      box-sizing: border-box;
    }
    
    * {
      font-family: 'Kanit', 'Sarabun', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }
    
    .menu-item {
      transition: all 0.2s;
      cursor: pointer;
    }
    
    .menu-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(218, 165, 32, 0.3);
    }
    
    .cart-item {
      animation: slideIn 0.3s ease-out;
    }
    
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #DAA520 0%, #B8860B 100%);
      transition: all 0.3s;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(218, 165, 32, 0.4);
    }
    
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 16px 24px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(218, 165, 32, 0.3);
      z-index: 1000;
      animation: slideInRight 0.3s ease-out;
    }
    
    @keyframes slideInRight {
      from {
        opacity: 0;
        transform: translateX(100px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .member-info-card {
      animation: fadeIn 0.3s ease-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .menu-item-image {
      width: 100%;
      height: 150px;
      object-fit: cover;
      border-radius: 8px;
      background: #f5f5f5;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body class="bg-gradient-to-br from-yellow-50 to-amber-50 min-h-full">
  <div id="app" class="w-full min-h-full"></div>
  <script>
    (function() {
      // =============================================
      // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Sheets URL
      // =============================================
      const GOOGLE_SHEETS_URL = 'https://script.google.com/macros/s/AKfycbxW6aMpv7QlYeI6kBF7whhot6_UzWNtlU4Zf0qyOzv2b62asbHt4xuXvI_0rjZUBj1c/exec';
      
      // =============================================
      // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£
      // =============================================
      const menuCategories = [
        'Appetizer & Snack - Normal',
        'Appetizer & Snack - High & Elite',
        'Main Dish',
        'Side Dish Vegetarian',
        'Promotion & Event',
        'Drink'
      ];

      const menuItems = [
        // Appetizer & Snack - Normal
        { id: 1, name: 'Tomato Fish Sauce', price: 90, category: 'Appetizer & Snack - Normal', image: 'https://img5.pic.in.th/file/secure-sv1/Tomato-Fish-Sauce.png' },
        { id: 2, name: 'MediterNachos', price: 135, category: 'Appetizer & Snack - Normal', image: 'https://img2.pic.in.th/pic/MediterNachos.png' },
        { id: 3, name: 'Cheese Appie Pie Bite', price: 135, category: 'Appetizer & Snack - Normal', image: 'https://img2.pic.in.th/pic/Cheese-Appie-Pie-Bite.png' },
        
        // Appetizer & Snack - High & Elite
        { id: 4, name: 'Scallops with Risotto Bites', price: 165, category: 'Appetizer & Snack - High & Elite', image: 'https://img5.pic.in.th/file/secure-sv1/Scallops-with-Risotto-Bites.png' },
        { id: 5, name: 'Greek Shrimp with Feta Cheese and Tomatoes', price: 135, category: 'Appetizer & Snack - High & Elite', image: 'https://img5.pic.in.th/file/secure-sv1/Greek-Shrimp-with-Feta-Cheese-and-Tomatoes.png' },
        { id: 6, name: 'Prosciutto Wrapped Figs', price: 90, category: 'Appetizer & Snack - High & Elite', image: 'https://img2.pic.in.th/pic/Prosciutto-Wrapped-Figs.png' },
        
        // Main Dish
        { id: 7, name: 'Seafood Paella', price: 210, category: 'Main Dish', image: 'https://img2.pic.in.th/pic/Seafood-Paella-01.png' },
        { id: 8, name: 'Tortilla Espa√±ola', price: 210, category: 'Main Dish', image: 'https://img5.pic.in.th/file/secure-sv1/Tortilla-Espanola.png' },
        { id: 14, name: 'Lemon Basil Chicken Grill', price: 210, category: 'Main Dish', image: 'https://img5.pic.in.th/file/secure-sv1/Lemon-Basil-Chicken-Grill.png' },
        { id: 15, name: 'Amalfi Coast', price: 255, category: 'Main Dish', image: 'https://img5.pic.in.th/file/secure-sv1/Amalfi-Coast.png' },
        
        // Side Dish Vegetarian
        { id: 9, name: 'Eggs In Hell', price: 135, category: 'Side Dish Vegetarian', image: 'https://img2.pic.in.th/pic/Eggs-In-Hell.png' },
        { id: 10, name: 'Pesto Potato Salad', price: 135, category: 'Side Dish Vegetarian', image: 'https://img5.pic.in.th/file/secure-sv1/Pesto-Potato-Salad.png' },
        
        // Promotion & Event
        { id: 11, name: 'Alamo Small Set', price: 160, category: 'Promotion & Event', image: 'https://img2.pic.in.th/pic/Alamo-Small-Set.png', description: 'Appetizer 1 + Drink 1' },
        { id: 16, name: 'Alamo Med Set', price: 380, category: 'Promotion & Event', image: 'https://img5.pic.in.th/file/secure-sv1/Alamo-Med-Set.png', description: 'Appetizer 1 + Main Dish 1 + Drink 2' },
        { id: 17, name: 'Alamo Big Set', price: 750, category: 'Promotion & Event', image: 'https://img2.pic.in.th/pic/Alamo-Big-Set.png', description: 'Appetizer 2 + Main Dish or Side Dish 2 + Drink 3 or Premium Drink 1' },
        { id: 18, name: 'Alamo ValenSummer', price: 300, category: 'Promotion & Event', image: 'https://img2.pic.in.th/pic/Alamo-Set-Event.png' },
        
        // Drink
        { id: 12, name: 'Sparkling Water with Fresh Citrus and Mint', price: 45, category: 'Drink', image: 'https://img5.pic.in.th/file/secure-sv1/Sparkling-Water-with-Fresh-Citrus-and-Mint.png' },
        { id: 13, name: 'Iced Green Tea with Orange Slice', price: 90, category: 'Drink', image: 'https://img2.pic.in.th/pic/Iced-Green-Tea-with-Orange-Slice.png' },
        { id: 19, name: 'The Coral Grotto (Mocktail)', price: 45, category: 'Drink', image: 'https://img2.pic.in.th/pic/The-Coral-Grotto-Mocktail.png' },
        { id: 20, name: 'MediterBreeze (Cocktail)', price: 165, category: 'Drink', image: 'https://img2.pic.in.th/pic/MediterBreeze-Cocktail.png' },
        { id: 21, name: 'Premium Wine', price: 360, category: 'Drink', image: 'https://img5.pic.in.th/file/secure-sv1/Premium-Wine.png' },
        { id: 22, name: 'Premium Vodka', price: 510, category: 'Drink', image: 'https://img2.pic.in.th/pic/Premium-Vodka.png' }
      ];

      // =============================================
      // State Management
      // =============================================
      let currentView = 'pos'; // pos, kitchen, serve, sales, members
      let cart = [];
      let salesHistory = [];
      let members = [];
      let selectedTable = '';
      let selectedMember = null;
      let customerName = '';
      let checkinDiscount = 0; // ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô 5% (‡∏õ‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô)
      let selectedCategory = 'Appetizer & Snack - Normal'; // ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
      let memberSearchTerm = ''; // ‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å

      // =============================================
      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets ‡∏ú‡πà‡∏≤‡∏ô JSONP
      // =============================================
      function loadDataFromGoogleSheets() {
        return new Promise((resolve, reject) => {
          const callbackName = 'jsonpCallback_' + Date.now();
          
          window[callbackName] = function(data) {
            delete window[callbackName];
            const scripts = document.querySelectorAll('script[src*="' + GOOGLE_SHEETS_URL + '"]');
            scripts.forEach(s => s.remove());
            
            if (data.success && data.records) {
              const salesRecords = data.records.filter(r => r.transaction_id);
              const memberRecords = data.records.filter(r => r.member_id);
              
              salesHistory.length = 0;
              salesHistory.push(...salesRecords);
              
              members.length = 0;
              members.push(...memberRecords);
              
              console.log('‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', salesRecords.length, '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢,', memberRecords.length, '‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å');
              resolve(data);
            } else {
              reject(new Error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'));
            }
          };
          
          const script = document.createElement('script');
          script.src = GOOGLE_SHEETS_URL + '?callback=' + callbackName;
          script.onerror = () => {
            delete window[callbackName];
            reject(new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ'));
          };
          
          document.body.appendChild(script);
        });
      }

      // =============================================
      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ Google Sheets ‡∏ú‡πà‡∏≤‡∏ô JSONP
      // =============================================
      function saveDataToGoogleSheets() {
        return new Promise((resolve, reject) => {
          const callbackName = 'jsonpSaveCallback_' + Date.now();
          
          const data = {
            salesRecords: salesHistory,
            memberRecords: members
          };
          
          window[callbackName] = function(response) {
            delete window[callbackName];
            const scripts = document.querySelectorAll('script[src*="' + GOOGLE_SHEETS_URL + '"]');
            scripts.forEach(s => s.remove());
            
            if (response.success) {
              console.log('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
              resolve(response);
            } else {
              console.error('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ:', response.error);
              reject(new Error(response.error || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ'));
            }
          };
          
          const script = document.createElement('script');
          const encodedData = encodeURIComponent(JSON.stringify(data));
          script.src = GOOGLE_SHEETS_URL + '?action=save&data=' + encodedData + '&callback=' + callbackName;
          script.onerror = () => {
            delete window[callbackName];
            reject(new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ'));
          };
          
          document.body.appendChild(script);
        });
      }

      // =============================================
      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á Notification
      // =============================================
      function showNotification(message, type = 'success') {
        const notification = document.createElement('div');
        notification.className = 'notification';
        notification.innerHTML = `
          <div class="flex items-center gap-3">
            <span class="text-2xl">${type === 'success' ? '‚úÖ' : '‚ö†Ô∏è'}</span>
            <span class="font-medium">${message}</span>
          </div>
        `;
        document.body.appendChild(notification);
        
        setTimeout(() => {
          notification.style.animation = 'slideInRight 0.3s ease-out reverse';
          setTimeout(() => notification.remove(), 300);
        }, 3000);
      }

      // =============================================
      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠
      // =============================================
      function searchMemberByName(name) {
        customerName = name;
        
        if (!name || name.trim() === '') {
          selectedMember = null;
          customerName = '';
          // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï dropdown
          const memberSelect = document.getElementById('memberSelect');
          if (memberSelect) {
            memberSelect.value = '';
          }
          updateCartOnly();
          return;
        }
        
        // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡πÑ‡∏°‡πà‡∏Ñ‡∏≥‡∏ô‡∏∂‡∏á‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å-‡πÉ‡∏´‡∏ç‡πà)
        const normalizedName = name.trim().toLowerCase();
        const foundMember = members.find(m => 
          m.member_name.toLowerCase() === normalizedName
        );
        
        if (foundMember) {
          selectedMember = foundMember;
          // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï dropdown ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
          const memberSelect = document.getElementById('memberSelect');
          if (memberSelect) {
            memberSelect.value = foundMember.member_id;
          }
          showNotification(`‡∏û‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å: ${foundMember.member_name} ‚úÖ`, 'success');
        } else {
          selectedMember = null;
          const memberSelect = document.getElementById('memberSelect');
          if (memberSelect) {
            memberSelect.value = '';
          }
        }
        
        updateCartOnly();
      }

      // =============================================
      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
      // =============================================
      function addToCart(item) {
        const existingItem = cart.find(i => i.id === item.id);
        if (existingItem) {
          existingItem.quantity += 1;
          // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ã‡πá‡∏ï ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡∏î‡πâ‡∏ß‡∏¢
          if (isPromotionSet(item)) {
            existingItem.setSelections = existingItem.setSelections || [];
            existingItem.setSelections.push(createEmptySetSelection(item));
          }
        } else {
          const cartItem = { ...item, quantity: 1 };
          // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ã‡πá‡∏ï ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π
          if (isPromotionSet(item)) {
            cartItem.setSelections = [createEmptySetSelection(item)];
          }
          cart.push(cartItem);
        }
        updateCartOnly();
      }

      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ã‡πá‡∏ï‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
      function isPromotionSet(item) {
        return item.category === 'Promotion & Event' && 
               (item.name === 'Alamo Small Set' || 
                item.name === 'Alamo Med Set' || 
                item.name === 'Alamo Big Set');
      }

      // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏õ‡∏•‡πà‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ã‡πá‡∏ï
      function createEmptySetSelection(item) {
        if (item.name === 'Alamo Small Set') {
          return {
            appetizers: [],
            drinks: []
          };
        } else if (item.name === 'Alamo Med Set') {
          return {
            appetizers: [],
            mainDishes: [],
            drinks: []
          };
        } else if (item.name === 'Alamo Big Set') {
          return {
            appetizers: [],
            mainOrSide: [],
            drinks: []
          };
        }
        return {};
      }

      // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π‡∏•‡∏á‡πÉ‡∏ô‡πÄ‡∏ã‡πá‡∏ï
      function addItemToSet(cartItemId, setIndex, category, menuItem) {
        const cartItem = cart.find(i => i.id === cartItemId);
        if (!cartItem || !cartItem.setSelections) return;
        
        const selection = cartItem.setSelections[setIndex];
        if (!selection) return;
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏ï‡πá‡∏°‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
        const limits = getSetLimits(cartItem.name);
        if (!limits) return;
        
        const currentCount = selection[category]?.length || 0;
        const maxCount = limits[category] || 0;
        
        if (currentCount >= maxCount) {
          showNotification(`‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î ${maxCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`, 'error');
          return;
        }
        
        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π
        if (!selection[category]) {
          selection[category] = [];
        }
        selection[category].push(menuItem);
        
        updateCartOnly();
      }

      // ‡∏•‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡πá‡∏ï
      function removeItemFromSet(cartItemId, setIndex, category, itemIndex) {
        const cartItem = cart.find(i => i.id === cartItemId);
        if (!cartItem || !cartItem.setSelections) return;
        
        const selection = cartItem.setSelections[setIndex];
        if (!selection || !selection[category]) return;
        
        selection[category].splice(itemIndex, 1);
        updateCartOnly();
      }

      // ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏ã‡πá‡∏ï
      function getSetLimits(setName) {
        if (setName === 'Alamo Small Set') {
          return { appetizers: 1, drinks: 1 };
        } else if (setName === 'Alamo Med Set') {
          return { appetizers: 1, mainDishes: 1, drinks: 2 };
        } else if (setName === 'Alamo Big Set') {
          return { appetizers: 2, mainOrSide: 2, drinks: 3 };
        }
        return null;
      }

      // ‡∏£‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà
      function getMenuItemsByCategory(category) {
        if (category === 'appetizers') {
          return menuItems.filter(m => 
            m.category === 'Appetizer & Snack - Normal' || 
            m.category === 'Appetizer & Snack - High & Elite'
          );
        } else if (category === 'mainDishes') {
          return menuItems.filter(m => m.category === 'Main Dish');
        } else if (category === 'mainOrSide') {
          return menuItems.filter(m => 
            m.category === 'Main Dish' || 
            m.category === 'Side Dish Vegetarian'
          );
        } else if (category === 'drinks') {
          return menuItems.filter(m => m.category === 'Drink');
        }
        return [];
      }

      function updateQuantity(itemId, delta) {
        const item = cart.find(i => i.id === itemId);
        if (item) {
          if (delta < 0 && item.quantity > 1) {
            // ‡∏•‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô - ‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ã‡πá‡∏ï‡∏î‡πâ‡∏ß‡∏¢
            if (item.setSelections && item.setSelections.length > 0) {
              item.setSelections.pop();
            }
            item.quantity += delta;
          } else if (delta > 0) {
            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô
            item.quantity += delta;
            // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ã‡πá‡∏ï ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡∏î‡πâ‡∏ß‡∏¢
            if (isPromotionSet(item)) {
              item.setSelections = item.setSelections || [];
              item.setSelections.push(createEmptySetSelection(item));
            }
          } else if (delta < 0 && item.quantity === 1) {
            // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏´‡∏•‡∏∑‡∏≠ 1 ‡πÅ‡∏•‡∏∞‡∏Å‡∏î - ‡∏à‡∏∞‡∏•‡∏ö‡∏ó‡∏¥‡πâ‡∏á
            cart = cart.filter(i => i.id !== itemId);
          }
        }
        updateCartOnly();
      }

      function removeFromCart(itemId) {
        cart = cart.filter(i => i.id !== itemId);
        updateCartOnly();
      }

      function clearCart() {
        cart = [];
        selectedTable = '';
        selectedMember = null;
        customerName = '';
        render();
      }

      // =============================================
      // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏Ñ‡∏≤
      // =============================================
      function calculateTotal() {
        return cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      }

      function calculateDiscount() {
        const total = calculateTotal();
        let memberDiscount = 0;
        
        if (selectedMember) {
          const discountPercent = getMemberDiscount(selectedMember);
          memberDiscount = total * (discountPercent / 100);
        }
        
        const checkinDiscountAmount = total * (checkinDiscount / 100);
        return memberDiscount + checkinDiscountAmount;
      }

      function calculateMemberDiscount() {
        if (!selectedMember) return 0;
        const total = calculateTotal();
        const discountPercent = getMemberDiscount(selectedMember);
        return total * (discountPercent / 100);
      }

      function calculateCheckinDiscount() {
        const total = calculateTotal();
        return total * (checkinDiscount / 100);
      }

      function calculateFinalAmount() {
        return calculateTotal() - calculateDiscount();
      }

      // =============================================
      // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤ (‡πÑ‡∏°‡πà‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏ô‡πâ‡∏≤)
      // =============================================
      function updateCartOnly() {
        const total = calculateTotal();
        const memberDiscount = calculateMemberDiscount();
        const checkinDiscountAmount = calculateCheckinDiscount();
        const totalDiscount = memberDiscount + checkinDiscountAmount;
        const finalAmount = calculateFinalAmount();

        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
        const cartItemsContainer = document.getElementById('cartItems');
        if (cartItemsContainer) {
          cartItemsContainer.innerHTML = cart.length === 0 ? `
            <div class="text-center text-yellow-700 py-8">
              <div class="text-4xl mb-2">üõçÔ∏è</div>
              <div>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</div>
            </div>
          ` : cart.map(item => {
            let itemHTML = `
              <div class="cart-item bg-yellow-50 rounded-lg p-3 mb-2 border-2 border-yellow-200">
                <div class="flex justify-between items-start mb-2">
                  <div class="font-medium text-gray-800">${item.name}</div>
                  <button onclick="removeFromCart(${item.id})" class="text-red-600 hover:text-red-800 font-bold">‚úï</button>
                </div>
            `;
            
            // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ã‡πá‡∏ï ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π
            if (item.setSelections && item.setSelections.length > 0) {
              item.setSelections.forEach((selection, setIndex) => {
                const limits = getSetLimits(item.name);
                itemHTML += `
                  <div class="mt-3 p-2 bg-white rounded border border-yellow-300">
                    <div class="text-xs font-bold text-yellow-700 mb-2">üéØ ‡πÄ‡∏ã‡πá‡∏ï‡∏ó‡∏µ‡πà ${setIndex + 1}</div>
                `;
                
                // Appetizers
                if (limits.appetizers) {
                  const appetizerCount = selection.appetizers?.length || 0;
                  itemHTML += `
                    <div class="mb-2">
                      <div class="text-xs text-gray-700 mb-1">Appetizer (${appetizerCount}/${limits.appetizers})</div>
                      ${selection.appetizers?.map((app, idx) => `
                        <div class="flex justify-between items-center text-xs bg-yellow-50 px-2 py-1 rounded mb-1">
                          <span>${app.name}</span>
                          <button onclick="removeItemFromSet(${item.id}, ${setIndex}, 'appetizers', ${idx})" class="text-red-600 hover:text-red-800 font-bold">‚úï</button>
                        </div>
                      `).join('') || ''}
                      ${appetizerCount < limits.appetizers ? `
                        <select onchange="if(this.value) { const m = ${JSON.stringify(getMenuItemsByCategory('appetizers')).replace(/"/g, '&quot;')}.find(x => x.id == this.value); addItemToSet(${item.id}, ${setIndex}, 'appetizers', m); this.value = ''; }" class="w-full text-xs px-2 py-1 border border-yellow-300 rounded">
                          <option value="">+ ‡πÄ‡∏û‡∏¥‡πà‡∏° Appetizer</option>
                          ${getMenuItemsByCategory('appetizers').map(m => `<option value="${m.id}">${m.name}</option>`).join('')}
                        </select>
                      ` : ''}
                    </div>
                  `;
                }
                
                // Main Dishes
                if (limits.mainDishes) {
                  const mainCount = selection.mainDishes?.length || 0;
                  itemHTML += `
                    <div class="mb-2">
                      <div class="text-xs text-gray-700 mb-1">Main Dish (${mainCount}/${limits.mainDishes})</div>
                      ${selection.mainDishes?.map((main, idx) => `
                        <div class="flex justify-between items-center text-xs bg-yellow-50 px-2 py-1 rounded mb-1">
                          <span>${main.name}</span>
                          <button onclick="removeItemFromSet(${item.id}, ${setIndex}, 'mainDishes', ${idx})" class="text-red-600 hover:text-red-800 font-bold">‚úï</button>
                        </div>
                      `).join('') || ''}
                      ${mainCount < limits.mainDishes ? `
                        <select onchange="if(this.value) { const m = ${JSON.stringify(getMenuItemsByCategory('mainDishes')).replace(/"/g, '&quot;')}.find(x => x.id == this.value); addItemToSet(${item.id}, ${setIndex}, 'mainDishes', m); this.value = ''; }" class="w-full text-xs px-2 py-1 border border-yellow-300 rounded">
                          <option value="">+ ‡πÄ‡∏û‡∏¥‡πà‡∏° Main Dish</option>
                          ${getMenuItemsByCategory('mainDishes').map(m => `<option value="${m.id}">${m.name}</option>`).join('')}
                        </select>
                      ` : ''}
                    </div>
                  `;
                }
                
                // Main or Side
                if (limits.mainOrSide) {
                  const mainOrSideCount = selection.mainOrSide?.length || 0;
                  itemHTML += `
                    <div class="mb-2">
                      <div class="text-xs text-gray-700 mb-1">Main/Side Dish (${mainOrSideCount}/${limits.mainOrSide})</div>
                      ${selection.mainOrSide?.map((dish, idx) => `
                        <div class="flex justify-between items-center text-xs bg-yellow-50 px-2 py-1 rounded mb-1">
                          <span>${dish.name}</span>
                          <button onclick="removeItemFromSet(${item.id}, ${setIndex}, 'mainOrSide', ${idx})" class="text-red-600 hover:text-red-800 font-bold">‚úï</button>
                        </div>
                      `).join('') || ''}
                      ${mainOrSideCount < limits.mainOrSide ? `
                        <select onchange="if(this.value) { const m = ${JSON.stringify(getMenuItemsByCategory('mainOrSide')).replace(/"/g, '&quot;')}.find(x => x.id == this.value); addItemToSet(${item.id}, ${setIndex}, 'mainOrSide', m); this.value = ''; }" class="w-full text-xs px-2 py-1 border border-yellow-300 rounded">
                          <option value="">+ ‡πÄ‡∏û‡∏¥‡πà‡∏° Main/Side</option>
                          ${getMenuItemsByCategory('mainOrSide').map(m => `<option value="${m.id}">${m.name}</option>`).join('')}
                        </select>
                      ` : ''}
                    </div>
                  `;
                }
                
                // Drinks
                if (limits.drinks) {
                  const drinkCount = selection.drinks?.length || 0;
                  itemHTML += `
                    <div class="mb-2">
                      <div class="text-xs text-gray-700 mb-1">Drink (${drinkCount}/${limits.drinks})</div>
                      ${selection.drinks?.map((drink, idx) => `
                        <div class="flex justify-between items-center text-xs bg-yellow-50 px-2 py-1 rounded mb-1">
                          <span>${drink.name}</span>
                          <button onclick="removeItemFromSet(${item.id}, ${setIndex}, 'drinks', ${idx})" class="text-red-600 hover:text-red-800 font-bold">‚úï</button>
                        </div>
                      `).join('') || ''}
                      ${drinkCount < limits.drinks ? `
                        <select onchange="if(this.value) { const m = ${JSON.stringify(getMenuItemsByCategory('drinks')).replace(/"/g, '&quot;')}.find(x => x.id == this.value); addItemToSet(${item.id}, ${setIndex}, 'drinks', m); this.value = ''; }" class="w-full text-xs px-2 py-1 border border-yellow-300 rounded">
                          <option value="">+ ‡πÄ‡∏û‡∏¥‡πà‡∏° Drink</option>
                          ${getMenuItemsByCategory('drinks').map(m => `<option value="${m.id}">${m.name}</option>`).join('')}
                        </select>
                      ` : ''}
                    </div>
                  `;
                }
                
                itemHTML += `</div>`;
              });
            }
            
            itemHTML += `
                <div class="flex justify-between items-center mt-2">
                  <div class="flex items-center gap-2">
                    <button onclick="updateQuantity(${item.id}, -1)" class="w-8 h-8 bg-yellow-300 hover:bg-yellow-400 rounded-full font-bold">-</button>
                    <span class="w-8 text-center font-bold text-gray-800">${item.quantity}</span>
                    <button onclick="updateQuantity(${item.id}, 1)" class="w-8 h-8 bg-gradient-to-br from-yellow-500 to-amber-600 hover:from-yellow-600 hover:to-amber-700 text-white rounded-full font-bold">+</button>
                  </div>
                  <div class="font-bold text-yellow-700">$${item.price * item.quantity}</div>
                </div>
              </div>
            `;
            
            return itemHTML;
          }).join('');
        }

        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
        const memberInfoContainer = document.getElementById('memberInfoCard');
        if (memberInfoContainer) {
          if (selectedMember) {
            const currentVisits = selectedMember.visit_count || 0;
            const memberDiscountPercent = getMemberDiscount(selectedMember);
            
            let upgradeMessage = '';
            let visitDisplay = '';
            
            if (currentVisits === 0) {
              visitDisplay = `<span class="font-bold text-yellow-700">‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å! üéâ</span>`;
            } else {
              visitDisplay = `<span class="font-bold text-yellow-700">${currentVisits} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á <span class="text-xs text-gray-600">(+‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ô‡∏µ‡πâ)</span></span>`;
            }
            
            if (selectedMember.member_type === 'Silver') {
              const visitsToGold = Math.max(0, 10 - currentVisits - 1);
              if (currentVisits + 1 >= 10) {
                upgradeMessage = '<div class="text-amber-700 font-bold">üéâ ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏õ‡πá‡∏ô Gold ‡πÅ‡∏•‡πâ‡∏ß!</div>';
              } else if (visitsToGold > 0) {
                upgradeMessage = `<div class="text-gray-700">‡∏≠‡∏µ‡∏Å ${visitsToGold} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏õ‡πá‡∏ô Gold</div>`;
              }
            } else if (selectedMember.member_type === 'Gold') {
              const visitsToPlatinum = Math.max(0, 20 - currentVisits - 1);
              if (currentVisits + 1 >= 20) {
                upgradeMessage = '<div class="text-yellow-700 font-bold">üéâ ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏õ‡πá‡∏ô Platinum ‡πÅ‡∏•‡πâ‡∏ß!</div>';
              } else if (visitsToPlatinum > 0) {
                upgradeMessage = `<div class="text-gray-700">‡∏≠‡∏µ‡∏Å ${visitsToPlatinum} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏õ‡πá‡∏ô Platinum</div>`;
              }
            } else {
              upgradeMessage = '<div class="text-yellow-700 font-bold">‚ú® ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß!</div>';
            }

            memberInfoContainer.innerHTML = `
              <div class="member-info-card bg-gradient-to-br from-yellow-50 to-amber-50 rounded-lg p-4 border-2 border-yellow-400">
                <div class="flex items-center justify-between mb-2">
                  <div class="font-bold text-yellow-800">üë§ ${selectedMember.member_name}</div>
                  <span class="px-3 py-1 rounded-full text-xs font-bold ${
                    selectedMember.member_type === 'Platinum' ? 'bg-yellow-200 text-yellow-900' :
                    selectedMember.member_type === 'Gold' ? 'bg-amber-200 text-amber-900' :
                    'bg-yellow-100 text-yellow-800'
                  }">
                    ${selectedMember.member_type}
                  </span>
                </div>
                <div class="text-sm space-y-1">
                  <div class="flex justify-between">
                    <span class="text-gray-700">‡∏ö‡∏±‡∏ï‡∏£:</span>
                    <span class="font-medium text-gray-800">${selectedMember.card_type === 'JEMs Black Card' ? 'üñ§ Black Card' : 'üíé Member Card'}</span>
                  </div>
                  <div class="flex justify-between">
                    <span class="text-gray-700">‡∏°‡∏≤‡∏ó‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß:</span>
                    ${visitDisplay}
                  </div>
                  <div class="flex justify-between">
                    <span class="text-gray-700">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î:</span>
                    <span class="font-bold text-yellow-700">${memberDiscountPercent}%</span>
                  </div>
                  <div class="mt-2 pt-2 border-t border-yellow-300">
                    ${upgradeMessage}
                  </div>
                </div>
              </div>
            `;
          } else {
            memberInfoContainer.innerHTML = '';
          }
        }

        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°
        const summaryContainer = document.getElementById('cartSummary');
        if (summaryContainer) {
          summaryContainer.innerHTML = `
            <div class="flex justify-between text-gray-700">
              <span>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°:</span>
              <span>$${total.toFixed(2)}</span>
            </div>
            ${memberDiscount > 0 && selectedMember ? `
              <div class="flex justify-between text-yellow-700">
                <span>‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å (${getMemberDiscount(members.find(m => m.member_id === selectedMember.member_id))}%):</span>
                <span>-$${memberDiscount.toFixed(2)}</span>
              </div>
            ` : ''}
            ${checkinDiscountAmount > 0 ? `
              <div class="flex justify-between text-amber-700">
                <span>‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô (5%):</span>
                <span>-$${checkinDiscountAmount.toFixed(2)}</span>
              </div>
            ` : ''}
            ${totalDiscount > 0 ? `
              <div class="flex justify-between text-amber-800 font-semibold">
                <span>‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏£‡∏ß‡∏°:</span>
                <span>-$${totalDiscount.toFixed(2)}</span>
              </div>
            ` : ''}
            <div class="flex justify-between text-xl font-bold text-yellow-700">
              <span>‡∏¢‡∏≠‡∏î‡∏ä‡∏≥‡∏£‡∏∞:</span>
              <span>$${finalAmount.toFixed(2)}</span>
            </div>
          `;
        }

        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï dropdown ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å - ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß
        const memberSelect = document.getElementById('memberSelect');
        if (memberSelect) {
          const filteredMembers = !customerName || customerName.trim() === '' 
            ? [] 
            : members.filter(m => m.member_name.toLowerCase().includes(customerName.toLowerCase()));
          
          memberSelect.innerHTML = `
            <option value="">-- ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å --</option>
            ${filteredMembers.map(m => `
              <option value="${m.member_id}" ${selectedMember && selectedMember.member_id === m.member_id ? 'selected' : ''}>
                ${m.member_name} - ${m.card_type} (${m.member_type}) - ‡∏•‡∏î ${getMemberDiscount(m)}%
              </option>
            `).join('')}
          `;
        }

        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠
        const memberSelectHelper = document.getElementById('memberSelectHelper');
        if (memberSelectHelper) {
          if (!customerName || customerName.trim() === '') {
            memberSelectHelper.innerHTML = '<div class="mt-1 text-xs text-gray-600">üí° ‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</div>';
          } else {
            const filteredCount = members.filter(m => m.member_name.toLowerCase().includes(customerName.toLowerCase())).length;
            if (filteredCount === 0) {
              memberSelectHelper.innerHTML = `<div class="mt-1 text-xs text-red-600">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö "${customerName}"</div>`;
            } else if (!selectedMember) {
              memberSelectHelper.innerHTML = `<div class="mt-1 text-xs text-yellow-700">‡∏û‡∏ö ${filteredCount} ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô - ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á</div>`;
            } else {
              memberSelectHelper.innerHTML = '';
            }
          }
        }
      }

      // =============================================
      // ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
      // =============================================
      async function processPayment(method) {
        if (cart.length === 0) {
          showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤', 'error');
          return;
        }

        if (!selectedTable) {
          showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏•‡∏Ç‡πÇ‡∏ï‡πä‡∏∞', 'error');
          return;
        }

        const memberDiscountPercent = selectedMember ? getMemberDiscount(selectedMember) : 0;
        const memberDiscountAmount = calculateMemberDiscount();
        const checkinDiscountAmount = calculateCheckinDiscount();

        const transaction = {
          transaction_id: 'TXN-' + Date.now(),
          items: cart.map(item => `${item.name} x${item.quantity}`).join(', '),
          total_amount: calculateFinalAmount(),
          original_amount: calculateTotal(),
          discount_amount: calculateDiscount(),
          member_discount_percent: memberDiscountPercent,
          member_discount_amount: memberDiscountAmount,
          checkin_discount_percent: checkinDiscount,
          checkin_discount_amount: checkinDiscountAmount,
          payment_method: method,
          timestamp: new Date().toLocaleString('th-TH'),
          table_number: selectedTable,
          customer_name: customerName,
          used_member_id: selectedMember ? selectedMember.member_id : '',
          used_member_name: selectedMember ? selectedMember.member_name : '',
          used_member_type: selectedMember ? selectedMember.member_type : '',
          used_card_type: selectedMember ? selectedMember.card_type : '',
          member_tier: selectedMember ? selectedMember.member_type : '',
          points_earned: selectedMember ? Math.floor(calculateFinalAmount() / 10) : 0,
          kitchen_cooked: false,
          serve_served: false
        };

        salesHistory.unshift(transaction);

        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÅ‡∏•‡∏∞‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏ó‡∏≤‡∏ô
        if (selectedMember) {
          const member = members.find(m => m.member_id === selectedMember.member_id);
          if (member) {
            member.total_points = (member.total_points || 0) + transaction.points_earned;
            member.visit_count = (member.visit_count || 0) + 1;
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏û‡πÄ‡∏Å‡∏£‡∏î‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
            const upgraded = checkAndUpgradeTier(member);
            if (upgraded) {
              showNotification(`üéâ ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢! ${member.member_name} ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡πÄ‡∏õ‡πá‡∏ô ${member.member_type} ‡πÅ‡∏•‡πâ‡∏ß!`, 'success');
            }
          }
        }

        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Google Sheets
        try {
          await saveDataToGoogleSheets();
          showNotification('‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
        } catch (error) {
          console.error('Error saving:', error);
          showNotification('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'error');
        }

        clearCart();
      }

      // =============================================
      // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
      // =============================================
      function getMemberDiscount(member) {
        const cardType = member.card_type;
        const tier = member.member_type;
        
        if (cardType === 'JEMs Member Card') {
          if (tier === 'Silver') return 5;
          if (tier === 'Gold') return 7;
          if (tier === 'Platinum') return 10;
        } else if (cardType === 'JEMs Black Card') {
          if (tier === 'Silver') return 7;
          if (tier === 'Gold') return 10;
          if (tier === 'Platinum') return 12;
        }
        return 0;
      }

      function checkAndUpgradeTier(member) {
        const visitCount = member.visit_count || 0;
        let upgraded = false;
        
        if (visitCount >= 20 && member.member_type !== 'Platinum') {
          member.member_type = 'Platinum';
          upgraded = true;
        } else if (visitCount >= 10 && member.member_type === 'Silver') {
          member.member_type = 'Gold';
          upgraded = true;
        }
        
        return upgraded;
      }

      function registerMember(name, phone, cardType) {
        if (!name || !phone) {
          showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö', 'error');
          return;
        }

        const newMember = {
          member_id: 'MEM-' + Date.now(),
          member_name: name,
          member_type: 'Silver',
          card_type: cardType,
          member_phone: phone,
          member_registered: new Date().toLocaleDateString('th-TH'),
          total_points: 0,
          visit_count: 0
        };

        members.push(newMember);
        saveDataToGoogleSheets();
        showNotification('‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
        render();
      }

      // =============================================
      // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ß‡πÅ‡∏•‡∏∞‡πÄ‡∏™‡∏¥‡∏£‡πå‡∏ü
      // =============================================
      async function updateKitchenStatus(txnId, status) {
        const sale = salesHistory.find(s => s.transaction_id === txnId);
        if (sale) {
          sale.kitchen_cooked = status;
          if (status) {
            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÄ‡∏™‡∏£‡πá‡∏à
            sale.kitchen_completed_time = Date.now();
          } else {
            // ‡∏•‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÄ‡∏™‡∏£‡πá‡∏à‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏¢‡πâ‡∏≤‡∏¢‡∏Å‡∏•‡∏±‡∏ö
            delete sale.kitchen_completed_time;
          }
          await saveDataToGoogleSheets();
          render();
        }
      }

      async function updateServeStatus(txnId, status) {
        const sale = salesHistory.find(s => s.transaction_id === txnId);
        if (sale) {
          sale.serve_served = status;
          if (status) {
            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏™‡∏£‡πá‡∏à
            sale.serve_completed_time = Date.now();
          } else {
            // ‡∏•‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏™‡∏£‡πá‡∏à‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏¢‡πâ‡∏≤‡∏¢‡∏Å‡∏•‡∏±‡∏ö
            delete sale.serve_completed_time;
          }
          await saveDataToGoogleSheets();
          render();
        }
      }

      // =============================================
      // ‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
      // =============================================
      let autoUpdateInterval = null;
      let hideCompletedInterval = null;

      function startAutoUpdate() {
        // ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÄ‡∏î‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
        if (autoUpdateInterval) {
          clearInterval(autoUpdateInterval);
        }

        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets ‡∏ó‡∏∏‡∏Å 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏Ñ‡∏£‡∏±‡∏ß‡πÅ‡∏•‡∏∞‡πÄ‡∏™‡∏¥‡∏£‡πå‡∏ü)
        autoUpdateInterval = setInterval(async () => {
          if (currentView === 'kitchen' || currentView === 'serve') {
            try {
              await loadDataFromGoogleSheets();
              render();
            } catch (error) {
              console.error('Auto-update error:', error);
            }
          }
        }, 5000); // 5000ms = 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ

        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ã‡πà‡∏≠‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÄ‡∏™‡∏£‡πá‡∏à‡∏ó‡∏∏‡∏Å 1 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (‡πÄ‡∏ä‡πá‡∏Ñ‡πÅ‡∏ö‡∏ö real-time)
        if (hideCompletedInterval) {
          clearInterval(hideCompletedInterval);
        }
        
        hideCompletedInterval = setInterval(() => {
          if (currentView === 'kitchen' || currentView === 'serve') {
            render();
          }
        }, 1000); // 1000ms = 1 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
      }

      function stopAutoUpdate() {
        if (autoUpdateInterval) {
          clearInterval(autoUpdateInterval);
          autoUpdateInterval = null;
        }
        if (hideCompletedInterval) {
          clearInterval(hideCompletedInterval);
          hideCompletedInterval = null;
        }
      }

      // =============================================
      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
      // =============================================
      function parseSaleDate(timestamp) {
        // ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: "15/1/2567 13:45:30" ‡∏´‡∏£‡∏∑‡∏≠ "15/1/2567, 13:45:30"
        const parts = timestamp.split(/[\s,]+/);
        const datePart = parts[0];
        const timePart = parts[1] || '00:00:00';
        
        const dateComponents = datePart.split('/');
        if (dateComponents.length === 3) {
          const day = parseInt(dateComponents[0]);
          const month = parseInt(dateComponents[1]) - 1;
          const yearBE = parseInt(dateComponents[2]);
          const yearCE = yearBE - 543;
          
          const timeComponents = timePart.split(':');
          const hours = parseInt(timeComponents[0]) || 0;
          const minutes = parseInt(timeComponents[1]) || 0;
          const seconds = parseInt(timeComponents[2]) || 0;
          
          return new Date(yearCE, month, day, hours, minutes, seconds);
        }
        
        return new Date(timestamp);
      }

      // =============================================
      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà
      // =============================================
      function selectCategory(category) {
        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡πÅ‡∏ñ‡∏ö‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà
        const categoryBar = document.getElementById('categoryBar');
        const scrollPosition = categoryBar ? categoryBar.scrollLeft : 0;
        
        selectedCategory = category;
        render();
        
        // ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å render ‡πÄ‡∏™‡∏£‡πá‡∏à
        setTimeout(() => {
          const newCategoryBar = document.getElementById('categoryBar');
          if (newCategoryBar) {
            newCategoryBar.scrollLeft = scrollPosition;
          }
        }, 0);
      }

      // =============================================
      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏£‡∏≠‡∏á‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
      // =============================================
      function filterMemberList(searchTerm) {
        memberSearchTerm = searchTerm;
        
        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà render ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏ô‡πâ‡∏≤
        const tableBody = document.querySelector('#memberTableBody');
        if (!tableBody) return;
        
        const filteredMembers = memberSearchTerm 
          ? members.filter(m => m.member_name.toLowerCase().includes(memberSearchTerm.toLowerCase()))
          : members;
        
        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
        const memberCountHeader = document.querySelector('#memberCountHeader');
        if (memberCountHeader) {
          memberCountHeader.textContent = `‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (${filteredMembers.length})`;
        }
        
        tableBody.innerHTML = filteredMembers.length === 0 ? `
          <tr><td colspan="6" class="text-center py-8 text-yellow-600">${memberSearchTerm ? '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤' : '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å'}</td></tr>
        ` : filteredMembers.map(member => {
          const visitCount = member.visit_count || 0;
          let currentTier = 'Silver';
          if (visitCount >= 20) {
            currentTier = 'Platinum';
          } else if (visitCount >= 10) {
            currentTier = 'Gold';
          }
          
          const memberWithCurrentTier = {
            ...member,
            member_type: currentTier
          };
          
          return `
          <tr class="border-b border-yellow-100 hover:bg-yellow-50">
            <td class="px-4 py-3 font-medium text-gray-800">${member.member_name}</td>
            <td class="px-4 py-3">
              <span class="px-2 py-1 rounded text-xs font-bold ${
                member.card_type === 'JEMs Black Card' ? 'bg-gray-800 text-white' :
                'bg-yellow-200 text-yellow-900'
              }">
                ${member.card_type === 'JEMs Black Card' ? 'üñ§ Black' : 'üíé Member'}
              </span>
            </td>
            <td class="px-4 py-3">
              <span class="px-3 py-1 rounded-full text-sm font-bold ${
                currentTier === 'Platinum' ? 'bg-yellow-200 text-yellow-900' :
                currentTier === 'Gold' ? 'bg-amber-200 text-amber-900' :
                'bg-yellow-100 text-yellow-800'
              }">
                ${currentTier}
              </span>
            </td>
            <td class="px-4 py-3 font-bold text-yellow-700">${getMemberDiscount(memberWithCurrentTier)}%</td>
            <td class="px-4 py-3 text-gray-800">${member.member_phone}</td>
            <td class="px-4 py-3 text-center font-bold text-gray-800">${visitCount} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</td>
          </tr>
        `;
        }).join('');
      }

      // =============================================
      // Render Functions
      // =============================================
      function renderPOS() {
        const total = calculateTotal();
        const memberDiscount = calculateMemberDiscount();
        const checkinDiscountAmount = calculateCheckinDiscount();
        const totalDiscount = memberDiscount + checkinDiscountAmount;
        const finalAmount = calculateFinalAmount();

        // ‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏°‡∏ô‡∏π‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
        const displayItems = menuItems.filter(item => item.category === selectedCategory);

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á HTML ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
        let memberInfoHTML = '';
        if (selectedMember) {
          const member = members.find(m => m.member_id === selectedMember.member_id) || selectedMember;
          const currentVisits = member.visit_count || 0;
          const memberDiscountPercent = getMemberDiscount(member);
          
          let upgradeMessage = '';
          let visitDisplay = '';
          
          if (currentVisits === 0) {
            visitDisplay = `<span class="font-bold text-yellow-700">‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å! üéâ</span>`;
          } else {
            visitDisplay = `<span class="font-bold text-yellow-700">${currentVisits} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á <span class="text-xs text-gray-600">(+‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ô‡∏µ‡πâ)</span></span>`;
          }
          
          if (member.member_type === 'Silver') {
            const visitsToGold = Math.max(0, 10 - currentVisits - 1);
            if (currentVisits + 1 >= 10) {
              upgradeMessage = '<div class="text-amber-700 font-bold">üéâ ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏õ‡πá‡∏ô Gold ‡πÅ‡∏•‡πâ‡∏ß!</div>';
            } else if (visitsToGold > 0) {
              upgradeMessage = `<div class="text-gray-700">‡∏≠‡∏µ‡∏Å ${visitsToGold} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏õ‡πá‡∏ô Gold</div>`;
            }
          } else if (member.member_type === 'Gold') {
            const visitsToPlatinum = Math.max(0, 20 - currentVisits - 1);
            if (currentVisits + 1 >= 20) {
              upgradeMessage = '<div class="text-yellow-700 font-bold">üéâ ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏õ‡πá‡∏ô Platinum ‡πÅ‡∏•‡πâ‡∏ß!</div>';
            } else if (visitsToPlatinum > 0) {
              upgradeMessage = `<div class="text-gray-700">‡∏≠‡∏µ‡∏Å ${visitsToPlatinum} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏õ‡πá‡∏ô Platinum</div>`;
            }
          } else {
            upgradeMessage = '<div class="text-yellow-700 font-bold">‚ú® ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß!</div>';
          }

          memberInfoHTML = `
            <div class="member-info-card bg-gradient-to-br from-yellow-50 to-amber-50 rounded-lg p-4 border-2 border-yellow-400 mb-4">
              <div class="flex items-center justify-between mb-2">
                <div class="font-bold text-yellow-800">üë§ ${member.member_name}</div>
                <span class="px-3 py-1 rounded-full text-xs font-bold ${
                  member.member_type === 'Platinum' ? 'bg-yellow-200 text-yellow-900' :
                  member.member_type === 'Gold' ? 'bg-amber-200 text-amber-900' :
                  'bg-yellow-100 text-yellow-800'
                }">
                  ${member.member_type}
                </span>
              </div>
              <div class="text-sm space-y-1">
                <div class="flex justify-between">
                  <span class="text-gray-700">‡∏ö‡∏±‡∏ï‡∏£:</span>
                  <span class="font-medium text-gray-800">${member.card_type === 'JEMs Black Card' ? 'üñ§ Black Card' : 'üíé Member Card'}</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-700">‡∏°‡∏≤‡∏ó‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß:</span>
                  ${visitDisplay}
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-700">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î:</span>
                  <span class="font-bold text-yellow-700">${memberDiscountPercent}%</span>
                </div>
                <div class="mt-2 pt-2 border-t border-yellow-300">
                  ${upgradeMessage}
                </div>
              </div>
            </div>
          `;
        }

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á HTML ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö dropdown ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
        const filteredDropdownMembers = !customerName || customerName.trim() === '' 
          ? [] 
          : members.filter(m => m.member_name.toLowerCase().includes(customerName.toLowerCase()));

        return `
          <div class="flex gap-6 p-6 h-full">
            <!-- ‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£ -->
            <div class="flex-1 bg-white rounded-2xl shadow-lg p-6 overflow-hidden flex flex-col">
              <h2 class="text-2xl font-bold mb-4 text-yellow-700">üçΩÔ∏è ‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h2>
              
              <!-- ‡πÅ‡∏ñ‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà -->
              <div id="categoryBar" class="flex gap-2 mb-6 overflow-x-auto pb-2">
                <button onclick="window.selectCategory('Appetizer & Snack - Normal')" 
                  class="px-6 py-2 rounded-lg font-bold whitespace-nowrap transition-all ${selectedCategory === 'Appetizer & Snack - Normal' ? 'bg-gradient-to-br from-yellow-500 to-amber-600 text-white shadow-lg' : 'bg-yellow-100 text-yellow-800 hover:bg-yellow-200'}">
                  ü•ó Appetizer Normal
                </button>
                <button onclick="window.selectCategory('Appetizer & Snack - High & Elite')" 
                  class="px-6 py-2 rounded-lg font-bold whitespace-nowrap transition-all ${selectedCategory === 'Appetizer & Snack - High & Elite' ? 'bg-gradient-to-br from-yellow-500 to-amber-600 text-white shadow-lg' : 'bg-yellow-100 text-yellow-800 hover:bg-yellow-200'}">
                  ‚≠ê Appetizer Elite
                </button>
                <button onclick="window.selectCategory('Main Dish')" 
                  class="px-6 py-2 rounded-lg font-bold whitespace-nowrap transition-all ${selectedCategory === 'Main Dish' ? 'bg-gradient-to-br from-yellow-500 to-amber-600 text-white shadow-lg' : 'bg-yellow-100 text-yellow-800 hover:bg-yellow-200'}">
                  üçñ Main Dish
                </button>
                <button onclick="window.selectCategory('Side Dish Vegetarian')" 
                  class="px-6 py-2 rounded-lg font-bold whitespace-nowrap transition-all ${selectedCategory === 'Side Dish Vegetarian' ? 'bg-gradient-to-br from-yellow-500 to-amber-600 text-white shadow-lg' : 'bg-yellow-100 text-yellow-800 hover:bg-yellow-200'}">
                  ü•ó Side Dish
                </button>
                <button onclick="window.selectCategory('Promotion & Event')" 
                  class="px-6 py-2 rounded-lg font-bold whitespace-nowrap transition-all ${selectedCategory === 'Promotion & Event' ? 'bg-gradient-to-br from-yellow-500 to-amber-600 text-white shadow-lg' : 'bg-yellow-100 text-yellow-800 hover:bg-yellow-200'}">
                  üéâ Promotion
                </button>
                <button onclick="window.selectCategory('Drink')" 
                  class="px-6 py-2 rounded-lg font-bold whitespace-nowrap transition-all ${selectedCategory === 'Drink' ? 'bg-gradient-to-br from-yellow-500 to-amber-600 text-white shadow-lg' : 'bg-yellow-100 text-yellow-800 hover:bg-yellow-200'}">
                  üçπ Drink
                </button>
              </div>

              <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π‡πÅ‡∏ö‡∏ö Grid -->
              <div class="flex-1 overflow-y-auto">
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                  ${displayItems.map(item => `
                    <div class="menu-item bg-gradient-to-br from-yellow-50 to-amber-50 rounded-xl p-4 border-2 border-yellow-300" onclick="addToCart(${JSON.stringify(item).replace(/"/g, '&quot;')})">
                      <img src="${item.image}" alt="${item.name}" class="menu-item-image mb-3" onerror="this.src=''; this.alt='‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô'; this.style.display='none';">
                      <div class="font-semibold text-gray-800 mb-1">${item.name}</div>
                      ${item.description ? `
                        <div class="text-xs text-gray-600 mb-2 leading-tight">${item.description}</div>
                      ` : ''}
                      <div class="text-lg font-bold text-yellow-700">$${item.price}</div>
                    </div>
                  `).join('')}
                </div>
                ${displayItems.length === 0 ? `
                  <div class="text-center text-yellow-600 py-12">
                    <div class="text-5xl mb-3">üçΩÔ∏è</div>
                    <div class="text-lg">‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ô‡∏µ‡πâ</div>
                  </div>
                ` : ''}
              </div>
            </div>

            <!-- ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->
            <div class="w-96 bg-white rounded-2xl shadow-lg p-6 flex flex-col">
              <h2 class="text-2xl font-bold mb-4 text-yellow-700">üõí ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</h2>
              
              <!-- ‡πÄ‡∏•‡∏Ç‡πÇ‡∏ï‡πä‡∏∞ -->
              <div class="mb-4">
                <label for="tableNumber" class="block text-sm font-medium mb-2 text-gray-800">‡πÄ‡∏•‡∏Ç‡πÇ‡∏ï‡πä‡∏∞</label>
                <input type="text" id="tableNumber" value="${selectedTable}" oninput="window.updateTableNumber(this.value);" 
                  class="w-full px-4 py-2 border-2 border-yellow-300 rounded-lg focus:border-yellow-500 focus:outline-none"
                  placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏•‡∏Ç‡πÇ‡∏ï‡πä‡∏∞">
              </div>

              <!-- ‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å) -->
              <div class="mb-4">
                <label for="customerName" class="block text-sm font-medium mb-2 text-gray-800">‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</label>
                <input type="text" id="customerName" value="${selectedMember ? selectedMember.member_name : customerName}" 
                  oninput="window.searchMemberByName(this.value);" 
                  class="w-full px-4 py-2 border-2 ${selectedMember ? 'border-yellow-500' : 'border-yellow-300'} rounded-lg focus:border-yellow-500 focus:outline-none"
                  placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)">
                ${selectedMember ? `
                  <div class="mt-1 text-xs text-yellow-700 font-medium">‚úÖ ‡∏û‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å - ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î ${getMemberDiscount(selectedMember)}%</div>
                ` : ''}
              </div>

              <!-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å (‡∏™‡∏≥‡∏£‡∏≠‡∏á) -->
              <div class="mb-4">
                <label class="block text-sm font-medium mb-2 text-gray-800">‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠</label>
                <select id="memberSelect" onchange="window.selectMemberFromDropdown(this.value)" 
                  class="w-full px-4 py-2 border-2 border-yellow-300 rounded-lg focus:border-yellow-500 focus:outline-none">
                  <option value="">-- ${!customerName || customerName.trim() === '' ? '‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤' : '‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å'} --</option>
                  ${filteredDropdownMembers.map(m => `
                    <option value="${m.member_id}" ${selectedMember && selectedMember.member_id === m.member_id ? 'selected' : ''}>
                      ${m.member_name} - ${m.card_type} (${m.member_type}) - ‡∏•‡∏î ${getMemberDiscount(m)}%
                    </option>
                  `).join('')}
                </select>
                <div id="memberSelectHelper">
                  ${!customerName || customerName.trim() === '' ? `
                    <div class="mt-1 text-xs text-gray-600">üí° ‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</div>
                  ` : filteredDropdownMembers.length === 0 ? `
                    <div class="mt-1 text-xs text-red-600">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö "${customerName}"</div>
                  ` : !selectedMember ? `
                    <div class="mt-1 text-xs text-yellow-700">‡∏û‡∏ö ${filteredDropdownMembers.length} ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô - ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô</div>
                  ` : ''}
                </div>
              </div>

              <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å -->
              <div id="memberInfoCard">
                ${memberInfoHTML}
              </div>

              <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô 5% (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ) -->
              <div class="mb-4">
                <label class="flex items-center cursor-pointer">
                  <input type="checkbox" id="checkinDiscountToggle" ${checkinDiscount > 0 ? 'checked' : ''} 
                    onchange="window.toggleCheckinDiscount(this.checked)" 
                    class="w-5 h-5 text-yellow-600 rounded focus:ring-2 focus:ring-yellow-500">
                  <span class="ml-3 flex-1 flex items-center justify-between">
                    <span class="text-sm font-medium text-gray-800">‚úÖ ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô</span>
                    <span class="text-lg font-bold ${checkinDiscount > 0 ? 'text-yellow-700' : 'text-gray-400'}">5%</span>
                  </span>
                </label>
              </div>

              <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->
              <div id="cartItems" class="flex-1 overflow-y-auto mb-4">
                ${cart.length === 0 ? `
                  <div class="text-center text-yellow-700 py-8">
                    <div class="text-4xl mb-2">üõçÔ∏è</div>
                    <div>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</div>
                  </div>
                ` : cart.map(item => `
                  <div class="cart-item bg-yellow-50 rounded-lg p-3 mb-2 border-2 border-yellow-200">
                    <div class="flex justify-between items-start mb-2">
                      <div class="font-medium text-gray-800">${item.name}</div>
                      <button onclick="removeFromCart(${item.id})" class="text-red-600 hover:text-red-800 font-bold">‚úï</button>
                    </div>
                    <div class="flex justify-between items-center">
                      <div class="flex items-center gap-2">
                        <button onclick="updateQuantity(${item.id}, -1)" class="w-8 h-8 bg-yellow-300 hover:bg-yellow-400 rounded-full font-bold">-</button>
                        <span class="w-8 text-center font-bold text-gray-800">${item.quantity}</span>
                        <button onclick="updateQuantity(${item.id}, 1)" class="w-8 h-8 bg-gradient-to-br from-yellow-500 to-amber-600 hover:from-yellow-600 hover:to-amber-700 text-white rounded-full font-bold">+</button>
                      </div>
                      <div class="font-bold text-yellow-700">$${item.price * item.quantity}</div>
                    </div>
                  </div>
                `).join('')}
              </div>

              <!-- ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î -->
              <div id="cartSummary" class="border-t-2 border-yellow-300 pt-4 space-y-2">
                <div class="flex justify-between text-gray-700">
                  <span>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°:</span>
                  <span>$${total.toFixed(2)}</span>
                </div>
                ${memberDiscount > 0 && selectedMember ? `
                  <div class="flex justify-between text-yellow-700">
                    <span>‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å (${getMemberDiscount(members.find(m => m.member_id === selectedMember.member_id))}%):</span>
                    <span>-$${memberDiscount.toFixed(2)}</span>
                  </div>
                ` : ''}
                ${checkinDiscountAmount > 0 ? `
                  <div class="flex justify-between text-amber-700">
                    <span>‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô (5%):</span>
                    <span>-$${checkinDiscountAmount.toFixed(2)}</span>
                  </div>
                ` : ''}
                ${totalDiscount > 0 ? `
                  <div class="flex justify-between text-amber-800 font-semibold">
                    <span>‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏£‡∏ß‡∏°:</span>
                    <span>-$${totalDiscount.toFixed(2)}</span>
                  </div>
                ` : ''}
                <div class="flex justify-between text-xl font-bold text-yellow-700">
                  <span>‡∏¢‡∏≠‡∏î‡∏ä‡∏≥‡∏£‡∏∞:</span>
                  <span>$${finalAmount.toFixed(2)}</span>
                </div>
              </div>

              <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô -->
              <div class="grid grid-cols-2 gap-3 mt-4">
                <button onclick="processPayment('‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î')" class="btn-primary text-white py-3 rounded-lg font-bold shadow-lg">
                  üíµ ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î
                </button>
                <button onclick="processPayment('‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô')" class="btn-primary text-white py-3 rounded-lg font-bold shadow-lg">
                  üì± ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô
                </button>
              </div>
              <button onclick="clearCart()" class="w-full mt-2 bg-yellow-200 hover:bg-yellow-300 text-gray-800 py-2 rounded-lg font-bold">
                üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
              </button>
            </div>
          </div>
        `;
      }

      function renderKitchen() {
        const now = Date.now();
        const fifteenSeconds = 15 * 1000; // 15 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
        
        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏î‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô (‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏Å‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô)
        const pendingOrders = salesHistory
          .filter(s => !s.kitchen_cooked)
          .sort((a, b) => parseSaleDate(a.timestamp) - parseSaleDate(b.timestamp));
        
        // ‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÄ‡∏™‡∏£‡πá‡∏à‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 15 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÄ‡∏™‡∏£‡πá‡∏à (‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô)
        const completedOrders = salesHistory
          .filter(s => {
            if (!s.kitchen_cooked) return false;
            if (!s.kitchen_completed_time) return false; // ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏ß‡∏•‡∏≤
            return (now - s.kitchen_completed_time) < fifteenSeconds;
          })
          .sort((a, b) => (b.kitchen_completed_time || 0) - (a.kitchen_completed_time || 0));

        return `
          <div class="p-6">
            <div class="flex items-center justify-between mb-6">
              <h1 class="text-3xl font-bold text-yellow-800">üë®‚Äçüç≥ ‡∏Ñ‡∏£‡∏±‡∏ß</h1>
              <div class="flex items-center gap-2 bg-yellow-100 px-4 py-2 rounded-lg border-2 border-yellow-300">
                <div class="w-3 h-3 bg-yellow-500 rounded-full animate-pulse"></div>
                <span class="text-sm font-medium text-gray-800">‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏∏‡∏Å 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</span>
              </div>
            </div>
            
            <div class="grid grid-cols-2 gap-6">
              <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏ó‡∏≥ -->
              <div class="bg-white rounded-2xl shadow-lg p-6">
                <h2 class="text-xl font-bold mb-4 text-amber-700">‚è≥ ‡∏£‡∏≠‡∏ó‡∏≥ (${pendingOrders.length})</h2>
                <div class="space-y-3 max-h-[calc(100vh-250px)] overflow-y-auto">
                  ${pendingOrders.length === 0 ? `
                    <div class="text-center text-yellow-600 py-8">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏ó‡∏≥</div>
                  ` : pendingOrders.map(order => `
                    <div class="bg-amber-50 border-2 border-amber-300 rounded-lg p-4">
                      <div class="flex justify-between items-start mb-2">
                        <div class="font-bold text-lg text-gray-800">‡πÇ‡∏ï‡πä‡∏∞ ${order.table_number}</div>
                        <div class="text-sm text-gray-600">${order.timestamp}</div>
                      </div>
                      <div class="text-gray-800 mb-3">${order.items}</div>
                      <button onclick="updateKitchenStatus('${order.transaction_id}', true)" 
                        class="w-full bg-gradient-to-br from-yellow-500 to-amber-600 hover:from-yellow-600 hover:to-amber-700 text-white py-2 rounded-lg font-bold shadow-lg">
                        ‚úÖ ‡∏ó‡∏≥‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß
                      </button>
                    </div>
                  `).join('')}
                </div>
              </div>

              <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÄ‡∏™‡∏£‡πá‡∏à -->
              <div class="bg-white rounded-2xl shadow-lg p-6">
                <h2 class="text-xl font-bold mb-4 text-yellow-700">‚úÖ ‡∏ó‡∏≥‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß (${completedOrders.length})</h2>
                <div class="space-y-3 max-h-[calc(100vh-250px)] overflow-y-auto">
                  ${completedOrders.length === 0 ? `
                    <div class="text-center text-yellow-600 py-8">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÄ‡∏™‡∏£‡πá‡∏à</div>
                  ` : completedOrders.map(order => `
                    <div class="bg-yellow-50 border-2 border-yellow-300 rounded-lg p-4">
                      <div class="flex justify-between items-start mb-2">
                        <div class="font-bold text-lg text-gray-800">‡πÇ‡∏ï‡πä‡∏∞ ${order.table_number}</div>
                        <div class="text-sm text-gray-600">${order.timestamp}</div>
                      </div>
                      <div class="text-gray-800 mb-3">${order.items}</div>
                      <button onclick="updateKitchenStatus('${order.transaction_id}', false)" 
                        class="w-full bg-yellow-200 hover:bg-yellow-300 text-gray-800 py-2 rounded-lg font-bold">
                        ‚Ü©Ô∏è ‡∏¢‡πâ‡∏≤‡∏¢‡∏Å‡∏•‡∏±‡∏ö
                      </button>
                    </div>
                  `).join('')}
                </div>
              </div>
            </div>
          </div>
        `;
      }

      function renderServe() {
        const now = Date.now();
        const fifteenSeconds = 15 * 1000; // 15 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
        
        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏î‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô (‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏Å‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô)
        const readyToServe = salesHistory
          .filter(s => s.kitchen_cooked && !s.serve_served)
          .sort((a, b) => parseSaleDate(a.timestamp) - parseSaleDate(b.timestamp));
        
        // ‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏™‡∏£‡πá‡∏à‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 15 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏™‡∏£‡πá‡∏à (‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô)
        const served = salesHistory
          .filter(s => {
            if (!s.serve_served) return false;
            if (!s.serve_completed_time) return false; // ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏ß‡∏•‡∏≤
            return (now - s.serve_completed_time) < fifteenSeconds;
          })
          .sort((a, b) => (b.serve_completed_time || 0) - (a.serve_completed_time || 0));

        return `
          <div class="p-6">
            <div class="flex items-center justify-between mb-6">
              <h1 class="text-3xl font-bold text-yellow-800">üçΩÔ∏è ‡πÄ‡∏™‡∏¥‡∏£‡πå‡∏ü‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h1>
              <div class="flex items-center gap-2 bg-yellow-100 px-4 py-2 rounded-lg border-2 border-yellow-300">
                <div class="w-3 h-3 bg-yellow-500 rounded-full animate-pulse"></div>
                <span class="text-sm font-medium text-gray-800">‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏∏‡∏Å 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</span>
              </div>
            </div>
            
            <div class="grid grid-cols-2 gap-6">
              <!-- ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏™‡∏¥‡∏£‡πå‡∏ü -->
              <div class="bg-white rounded-2xl shadow-lg p-6">
                <h2 class="text-xl font-bold mb-4 text-amber-700">üîî ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏™‡∏¥‡∏£‡πå‡∏ü (${readyToServe.length})</h2>
                <div class="space-y-3 max-h-[calc(100vh-250px)] overflow-y-auto">
                  ${readyToServe.length === 0 ? `
                    <div class="text-center text-yellow-600 py-8">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏™‡∏¥‡∏£‡πå‡∏ü</div>
                  ` : readyToServe.map(order => `
                    <div class="bg-amber-50 border-2 border-amber-300 rounded-lg p-4">
                      <div class="flex justify-between items-start mb-2">
                        <div class="font-bold text-lg text-gray-800">‡πÇ‡∏ï‡πä‡∏∞ ${order.table_number}</div>
                        <div class="text-sm text-gray-600">${order.timestamp}</div>
                      </div>
                      <div class="text-gray-800 mb-3">${order.items}</div>
                      <button onclick="updateServeStatus('${order.transaction_id}', true)" 
                        class="w-full bg-gradient-to-br from-yellow-500 to-amber-600 hover:from-yellow-600 hover:to-amber-700 text-white py-2 rounded-lg font-bold shadow-lg">
                        ‚úÖ ‡πÄ‡∏™‡∏¥‡∏£‡πå‡∏ü‡πÅ‡∏•‡πâ‡∏ß
                      </button>
                    </div>
                  `).join('')}
                </div>
              </div>

              <!-- ‡πÄ‡∏™‡∏¥‡∏£‡πå‡∏ü‡πÅ‡∏•‡πâ‡∏ß -->
              <div class="bg-white rounded-2xl shadow-lg p-6">
                <h2 class="text-xl font-bold mb-4 text-yellow-700">‚úÖ ‡πÄ‡∏™‡∏¥‡∏£‡πå‡∏ü‡πÅ‡∏•‡πâ‡∏ß (${served.length})</h2>
                <div class="space-y-3 max-h-[calc(100vh-250px)] overflow-y-auto">
                  ${served.length === 0 ? `
                    <div class="text-center text-yellow-600 py-8">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏¥‡∏£‡πå‡∏ü‡πÅ‡∏•‡πâ‡∏ß</div>
                  ` : served.map(order => `
                    <div class="bg-yellow-50 border-2 border-yellow-300 rounded-lg p-4 opacity-75">
                      <div class="flex justify-between items-start mb-2">
                        <div class="font-bold text-lg text-gray-800">‡πÇ‡∏ï‡πä‡∏∞ ${order.table_number}</div>
                        <div class="text-sm text-gray-600">${order.timestamp}</div>
                      </div>
                      <div class="text-gray-800">${order.items}</div>
                    </div>
                  `).join('')}
                </div>
              </div>
            </div>
          </div>
        `;
      }

      // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
      let salesSearchTerm = '';

      function renderSales() {
        // ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏≤‡∏Å input
        const startDateInput = document.getElementById('startDate');
        const endDateInput = document.getElementById('endDate');
        
        let filteredSales = salesHistory;
        let dateRangeText = '';
        
        // ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
        if (startDateInput && endDateInput && startDateInput.value && endDateInput.value) {
          const startDate = new Date(startDateInput.value);
          startDate.setHours(0, 0, 0, 0);
          
          const endDate = new Date(endDateInput.value);
          endDate.setHours(23, 59, 59, 999);
          
          filteredSales = salesHistory.filter(sale => {
            const saleDate = parseSaleDate(sale.timestamp);
            return saleDate >= startDate && saleDate <= endDate;
          });
          
          dateRangeText = `‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà ${startDate.toLocaleDateString('th-TH')} ‡∏ñ‡∏∂‡∏á ${endDate.toLocaleDateString('th-TH')}`;
        }
        
        // ‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ (‡πÇ‡∏ï‡πä‡∏∞, ‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤, ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å)
        if (salesSearchTerm && salesSearchTerm.trim() !== '') {
          const searchLower = salesSearchTerm.toLowerCase().trim();
          filteredSales = filteredSales.filter(sale => {
            const tableMatch = sale.table_number.toLowerCase().includes(searchLower);
            const customerMatch = (sale.customer_name || '').toLowerCase().includes(searchLower);
            const memberMatch = (sale.used_member_name || '').toLowerCase().includes(searchLower);
            return tableMatch || customerMatch || memberMatch;
          });
        }
        
        const totalRevenue = filteredSales.reduce((sum, s) => sum + s.total_amount, 0);
        const totalDiscount = filteredSales.reduce((sum, s) => sum + s.discount_amount, 0);

        return `
          <div class="p-6">
            <h1 class="text-3xl font-bold mb-6 text-yellow-800">üìä ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢</h1>
            
            <!-- ‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà -->
            <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
              <h2 class="text-xl font-bold mb-4 text-yellow-700">üìÖ ‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</h2>
              <div class="flex items-end gap-4">
                <div class="flex-1">
                  <label for="startDate" class="block text-sm font-medium mb-2 text-gray-800">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</label>
                  <input type="date" id="startDate" 
                    class="w-full px-4 py-2 border-2 border-yellow-300 rounded-lg focus:border-yellow-500 focus:outline-none">
                </div>
                <div class="flex-1">
                  <label for="endDate" class="block text-sm font-medium mb-2 text-gray-800">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</label>
                  <input type="date" id="endDate" 
                    class="w-full px-4 py-2 border-2 border-yellow-300 rounded-lg focus:border-yellow-500 focus:outline-none">
                </div>
                <button onclick="filterSalesByDate()" class="px-6 py-2 bg-gradient-to-br from-yellow-500 to-amber-600 hover:from-yellow-600 hover:to-amber-700 text-white font-bold rounded-lg shadow-lg">
                  üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
                </button>
                <button onclick="clearDateFilter()" class="px-6 py-2 bg-yellow-200 hover:bg-yellow-300 text-gray-800 font-bold rounded-lg">
                  ‡∏•‡πâ‡∏≤‡∏á
                </button>
              </div>
              ${dateRangeText ? `
                <div class="mt-4 p-3 bg-yellow-50 border-2 border-yellow-300 rounded-lg text-yellow-800 font-medium">
                  üìÖ ${dateRangeText}
                </div>
              ` : ''}
            </div>
            
            <!-- ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ -->
            <div class="grid grid-cols-3 gap-6 mb-6">
              <div class="bg-white rounded-2xl shadow-lg p-6">
                <div class="text-gray-600 mb-2">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                <div class="text-3xl font-bold text-yellow-700">$${totalRevenue.toFixed(2)}</div>
              </div>
              <div class="bg-white rounded-2xl shadow-lg p-6">
                <div class="text-gray-600 mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
                <div class="text-3xl font-bold text-amber-700">${filteredSales.length}</div>
              </div>
              <div class="bg-white rounded-2xl shadow-lg p-6">
                <div class="text-gray-600 mb-2">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏£‡∏ß‡∏°</div>
                <div class="text-3xl font-bold text-yellow-700">$${totalDiscount.toFixed(2)}</div>
              </div>
            </div>

            <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢ -->
            <div class="bg-white rounded-2xl shadow-lg p-6">
              <h2 class="text-xl font-bold mb-4 text-yellow-700">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (${filteredSales.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</h2>
              
              <!-- ‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ -->
              <div class="mb-4">
                <input type="text" id="salesSearchInput" value="${salesSearchTerm}"
                  oninput="window.filterSalesData(this.value)"
                  class="w-full px-4 py-2 border-2 border-yellow-300 rounded-lg focus:border-yellow-500 focus:outline-none"
                  placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÇ‡∏ï‡πä‡∏∞, ‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤, ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å...">
              </div>
              
              <div class="overflow-x-auto max-h-[calc(100vh-560px)] overflow-y-auto">
                <table class="w-full">
                  <thead class="bg-yellow-100 sticky top-0">
                    <tr>
                      <th class="px-4 py-3 text-left text-gray-800">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                      <th class="px-4 py-3 text-left text-gray-800">‡πÄ‡∏ß‡∏•‡∏≤</th>
                      <th class="px-4 py-3 text-left text-gray-800">‡πÇ‡∏ï‡πä‡∏∞</th>
                      <th class="px-4 py-3 text-left text-gray-800">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
                      <th class="px-4 py-3 text-left text-gray-800">‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th>
                      <th class="px-4 py-3 text-left text-gray-800">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</th>
                      <th class="px-4 py-3 text-right text-gray-800">‡∏¢‡∏≠‡∏î‡πÄ‡∏ï‡πá‡∏°</th>
                      <th class="px-4 py-3 text-right text-gray-800">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</th>
                      <th class="px-4 py-3 text-right text-gray-800">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô</th>
                      <th class="px-4 py-3 text-right text-gray-800">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏£‡∏ß‡∏°</th>
                      <th class="px-4 py-3 text-right text-gray-800">‡∏¢‡∏≠‡∏î‡∏ä‡∏≥‡∏£‡∏∞</th>
                      <th class="px-4 py-3 text-left text-gray-800">‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞</th>
                    </tr>
                  </thead>
                  <tbody>
                    ${filteredSales.length === 0 ? `
                      <tr><td colspan="12" class="text-center py-8 text-yellow-600">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</td></tr>
                    ` : filteredSales.map(sale => {
                      const timestampParts = sale.timestamp.split(' ');
                      const datePart = timestampParts[0] || '';
                      const timePart = timestampParts[1] || '';
                      
                      return `
                      <tr class="border-b border-yellow-100 hover:bg-yellow-50">
                        <td class="px-4 py-3 text-sm">${datePart}</td>
                        <td class="px-4 py-3 text-sm">${timePart}</td>
                        <td class="px-4 py-3">${sale.table_number}</td>
                        <td class="px-4 py-3 text-sm">${sale.items}</td>
                        <td class="px-4 py-3 text-sm">${sale.customer_name || '-'}</td>
                        <td class="px-4 py-3 text-sm">${sale.used_member_name || '-'}</td>
                        <td class="px-4 py-3 text-right">$${sale.original_amount.toFixed(2)}</td>
                        <td class="px-4 py-3 text-right text-yellow-700">${sale.member_discount_amount > 0 ? `-$${sale.member_discount_amount.toFixed(2)}` : '-'}</td>
                        <td class="px-4 py-3 text-right text-amber-700">${sale.checkin_discount_amount > 0 ? `-$${sale.checkin_discount_amount.toFixed(2)}` : '-'}</td>
                        <td class="px-4 py-3 text-right text-amber-800 font-semibold">-$${sale.discount_amount.toFixed(2)}</td>
                        <td class="px-4 py-3 text-right font-bold text-yellow-700">$${sale.total_amount.toFixed(2)}</td>
                        <td class="px-4 py-3">${sale.payment_method}</td>
                      </tr>
                    `;
                    }).join('')}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        `;
      }

      function renderMembers() {
        // ‡∏Å‡∏£‡∏≠‡∏á‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
        const filteredMembers = memberSearchTerm 
          ? members.filter(m => m.member_name.toLowerCase().includes(memberSearchTerm.toLowerCase()))
          : members;

        return `
          <div class="p-6">
            <h1 class="text-3xl font-bold mb-6 text-yellow-800">üë• ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h1>
            
            <div class="grid grid-cols-3 gap-6">
              <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å -->
              <div class="bg-white rounded-2xl shadow-lg p-6">
                <h2 class="text-xl font-bold mb-4 text-yellow-700">‚ûï ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà</h2>
                <form onsubmit="event.preventDefault(); registerMember(document.getElementById('memberName').value, document.getElementById('memberPhone').value, document.getElementById('cardType').value); document.getElementById('memberName').value=''; document.getElementById('memberPhone').value='';">
                  <div class="mb-4">
                    <label for="memberName" class="block text-sm font-medium mb-2 text-gray-800">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                    <input type="text" id="memberName" required
                      class="w-full px-4 py-2 border-2 border-yellow-300 rounded-lg focus:border-yellow-500 focus:outline-none"
                      placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
                  </div>
                  <div class="mb-4">
                    <label for="memberPhone" class="block text-sm font-medium mb-2 text-gray-800">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label>
                    <input type="tel" id="memberPhone" required
                      class="w-full px-4 py-2 border-2 border-yellow-300 rounded-lg focus:border-yellow-500 focus:outline-none"
                      placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£">
                  </div>
                  <div class="mb-4">
                    <label for="cardType" class="block text-sm font-medium mb-2 text-gray-800">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ö‡∏±‡∏ï‡∏£</label>
                    <select id="cardType" 
                      class="w-full px-4 py-2 border-2 border-yellow-300 rounded-lg focus:border-yellow-500 focus:outline-none">
                      <option value="JEMs Member Card">The JEMs Member Card</option>
                      <option value="JEMs Black Card">The JEMs Black Card</option>
                    </select>
                  </div>
                  
                  <!-- ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å -->
                  <div class="bg-gradient-to-br from-yellow-50 to-amber-50 rounded-lg p-4 mb-4 text-sm border-2 border-yellow-300">
                    <div class="font-bold mb-2 text-yellow-800">üíé The JEMs Member Card:</div>
                    <div class="ml-3 space-y-1 text-gray-800">
                      <div>‚Ä¢ Silver: ‡∏•‡∏î 5% (‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å)</div>
                      <div>‚Ä¢ Gold: ‡∏•‡∏î 7% (‡∏ó‡∏≤‡∏ô 10 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á)</div>
                      <div>‚Ä¢ Platinum: ‡∏•‡∏î 10% (‡∏ó‡∏≤‡∏ô 20 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á)</div>
                    </div>
                    <div class="font-bold mt-3 mb-2 text-gray-900">üñ§ The JEMs Black Card:</div>
                    <div class="ml-3 space-y-1 text-gray-800">
                      <div>‚Ä¢ Silver: ‡∏•‡∏î 7% (‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å)</div>
                      <div>‚Ä¢ Gold: ‡∏•‡∏î 10% (‡∏ó‡∏≤‡∏ô 10 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á)</div>
                      <div>‚Ä¢ Platinum: ‡∏•‡∏î 12% (‡∏ó‡∏≤‡∏ô 20 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á)</div>
                    </div>
                  </div>

                  <button type="submit" class="w-full btn-primary text-white py-3 rounded-lg font-bold shadow-lg">
                    ‚úÖ ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
                  </button>
                </form>
              </div>

              <!-- ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å -->
              <div class="col-span-2 bg-white rounded-2xl shadow-lg p-6">
                <h2 id="memberCountHeader" class="text-xl font-bold mb-4 text-yellow-700">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (${filteredMembers.length})</h2>
                
                <!-- ‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å -->
                <div class="mb-4">
                  <input type="text" id="memberSearchInput" value="${memberSearchTerm}"
                    oninput="window.filterMemberList(this.value)"
                    class="w-full px-4 py-2 border-2 border-yellow-300 rounded-lg focus:border-yellow-500 focus:outline-none"
                    placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å...">
                </div>

                <div class="overflow-x-auto max-h-[calc(100vh-320px)] overflow-y-auto">
                  <table class="w-full">
                    <thead class="bg-yellow-100 sticky top-0">
                      <tr>
                        <th class="px-4 py-3 text-left text-gray-800">‡∏ä‡∏∑‡πà‡∏≠</th>
                        <th class="px-4 py-3 text-left text-gray-800">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ö‡∏±‡∏ï‡∏£</th>
                        <th class="px-4 py-3 text-left text-gray-800">‡∏£‡∏∞‡∏î‡∏±‡∏ö</th>
                        <th class="px-4 py-3 text-left text-gray-800">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</th>
                        <th class="px-4 py-3 text-left text-gray-800">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</th>
                        <th class="px-4 py-3 text-center text-gray-800">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á</th>
                      </tr>
                    </thead>
                    <tbody id="memberTableBody">
                      ${filteredMembers.length === 0 ? `
                        <tr><td colspan="6" class="text-center py-8 text-yellow-600">${memberSearchTerm ? '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤' : '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å'}</td></tr>
                      ` : filteredMembers.map(member => {
                        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏à‡∏≤‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏ó‡∏≤‡∏ô
                        const visitCount = member.visit_count || 0;
                        let currentTier = 'Silver';
                        if (visitCount >= 20) {
                          currentTier = 'Platinum';
                        } else if (visitCount >= 10) {
                          currentTier = 'Gold';
                        }
                        
                        // ‡∏™‡∏£‡πâ‡∏≤‡∏á member object ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
                        const memberWithCurrentTier = {
                          ...member,
                          member_type: currentTier
                        };
                        
                        return `
                        <tr class="border-b border-yellow-100 hover:bg-yellow-50">
                          <td class="px-4 py-3 font-medium text-gray-800">${member.member_name}</td>
                          <td class="px-4 py-3">
                            <span class="px-2 py-1 rounded text-xs font-bold ${
                              member.card_type === 'JEMs Black Card' ? 'bg-gray-800 text-white' :
                              'bg-yellow-200 text-yellow-900'
                            }">
                              ${member.card_type === 'JEMs Black Card' ? 'üñ§ Black' : 'üíé Member'}
                            </span>
                          </td>
                          <td class="px-4 py-3">
                            <span class="px-3 py-1 rounded-full text-sm font-bold ${
                              currentTier === 'Platinum' ? 'bg-yellow-200 text-yellow-900' :
                              currentTier === 'Gold' ? 'bg-amber-200 text-amber-900' :
                              'bg-yellow-100 text-yellow-800'
                            }">
                              ${currentTier}
                            </span>
                          </td>
                          <td class="px-4 py-3 font-bold text-yellow-700">${getMemberDiscount(memberWithCurrentTier)}%</td>
                          <td class="px-4 py-3 text-gray-800">${member.member_phone}</td>
                          <td class="px-4 py-3 text-center font-bold text-gray-800">${visitCount} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</td>
                        </tr>
                      `;
                      }).join('')}
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        `;
      }

      function selectMember(memberId) {
        if (memberId) {
          selectedMember = members.find(m => m.member_id === memberId);
        } else {
          selectedMember = null;
        }
        updateCartOnly();
      }

      function selectMemberFromDropdown(memberId) {
        if (memberId) {
          selectedMember = members.find(m => m.member_id === memberId);
          customerName = selectedMember ? selectedMember.member_name : '';
          // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï input ‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
          const customerNameInput = document.getElementById('customerName');
          if (customerNameInput) {
            customerNameInput.value = customerName;
          }
        } else {
          selectedMember = null;
          // ‡πÑ‡∏°‡πà‡∏•‡πâ‡∏≤‡∏á customerName ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏¢‡∏±‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ß‡πâ
        }
        updateCartOnly();
      }

      function render() {
        const app = document.getElementById('app');
        
        let content = '';
        switch(currentView) {
          case 'pos': content = renderPOS(); break;
          case 'kitchen': content = renderKitchen(); break;
          case 'serve': content = renderServe(); break;
          case 'sales': content = renderSales(); break;
          case 'members': content = renderMembers(); break;
        }

        app.innerHTML = `
          <!-- Navigation -->
          <nav class="bg-gradient-to-r from-yellow-600 to-amber-600 shadow-lg">
            <div class="px-6 py-4">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                  <img src="https://img2.pic.in.th/pic/-8717495b07c9b65b8.png" alt="Alamo Breeze Logo" class="h-12 w-auto" onerror="this.style.display='none';">
                  <h1 class="text-2xl font-bold text-white drop-shadow-lg">
                    Alamo Breeze POS
                  </h1>
                </div>
                <div class="flex gap-2">
                  <button onclick="window.switchView('pos')" 
                    class="px-6 py-2 rounded-lg font-bold transition-all shadow-md ${currentView === 'pos' ? 'bg-white text-yellow-700' : 'bg-yellow-500 text-white hover:bg-yellow-400'}">
                    üí∞ ‡∏Ç‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                  </button>
                  <button onclick="window.switchView('kitchen')" 
                    class="px-6 py-2 rounded-lg font-bold transition-all shadow-md ${currentView === 'kitchen' ? 'bg-white text-yellow-700' : 'bg-yellow-500 text-white hover:bg-yellow-400'}">
                    üë®‚Äçüç≥ ‡∏Ñ‡∏£‡∏±‡∏ß
                  </button>
                  <button onclick="window.switchView('serve')" 
                    class="px-6 py-2 rounded-lg font-bold transition-all shadow-md ${currentView === 'serve' ? 'bg-white text-yellow-700' : 'bg-yellow-500 text-white hover:bg-yellow-400'}">
                    üçΩÔ∏è ‡πÄ‡∏™‡∏¥‡∏£‡πå‡∏ü
                  </button>
                  <button onclick="window.switchView('sales')" 
                    class="px-6 py-2 rounded-lg font-bold transition-all shadow-md ${currentView === 'sales' ? 'bg-white text-yellow-700' : 'bg-yellow-500 text-white hover:bg-yellow-400'}">
                    üìä ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢
                  </button>
                  <button onclick="window.switchView('members')" 
                    class="px-6 py-2 rounded-lg font-bold transition-all shadow-md ${currentView === 'members' ? 'bg-white text-yellow-700' : 'bg-yellow-500 text-white hover:bg-yellow-400'}">
                    üë• ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
                  </button>
                </div>
              </div>
            </div>
          </nav>

          <!-- Content -->
          ${content}
        `;
      }

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤
      function switchView(view) {
        currentView = view;
        render();
        
        // ‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏Ñ‡∏£‡∏±‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏™‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
        if (view === 'kitchen' || view === 'serve') {
          startAutoUpdate();
        } else {
          stopAutoUpdate();
        }
      }

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡πÄ‡∏•‡∏Ç‡πÇ‡∏ï‡πä‡∏∞
      function updateTableNumber(value) {
        selectedTable = value;
      }

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô
      function toggleCheckinDiscount(enabled) {
        checkinDiscount = enabled ? 5 : 0;
        updateCartOnly();
      }

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
      function filterSalesByDate() {
        render();
      }

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
      function clearDateFilter() {
        const startDateInput = document.getElementById('startDate');
        const endDateInput = document.getElementById('endDate');
        if (startDateInput) startDateInput.value = '';
        if (endDateInput) endDateInput.value = '';
        salesSearchTerm = '';
        render();
      }

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≤‡∏¢
      function filterSalesData(searchTerm) {
        salesSearchTerm = searchTerm;
        render();
      }

      // Make functions available globally
      window.switchView = switchView;
      window.addToCart = addToCart;
      window.updateQuantity = updateQuantity;
      window.removeFromCart = removeFromCart;
      window.clearCart = clearCart;
      window.processPayment = processPayment;
      window.registerMember = registerMember;
      window.updateKitchenStatus = updateKitchenStatus;
      window.updateServeStatus = updateServeStatus;
      window.selectMember = selectMember;
      window.selectMemberFromDropdown = selectMemberFromDropdown;
      window.searchMemberByName = searchMemberByName;
      window.updateCartOnly = updateCartOnly;
      window.updateTableNumber = updateTableNumber;
      window.toggleCheckinDiscount = toggleCheckinDiscount;
      window.filterSalesByDate = filterSalesByDate;
      window.clearDateFilter = clearDateFilter;
      window.filterSalesData = filterSalesData;
      window.selectCategory = selectCategory;
      window.filterMemberList = filterMemberList;
      window.render = render;
      window.addItemToSet = addItemToSet;
      window.removeItemFromSet = removeItemFromSet;
      window.getSetLimits = getSetLimits;
      window.getMenuItemsByCategory = getMenuItemsByCategory;
      window.isPromotionSet = isPromotionSet;

      // Initialize
      loadDataFromGoogleSheets().then(() => {
        render();
        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ñ‡πâ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏Ñ‡∏£‡∏±‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏™‡∏¥‡∏£‡πå‡∏ü
        if (currentView === 'kitchen' || currentView === 'serve') {
          startAutoUpdate();
        }
      }).catch(error => {
        console.error('Error loading initial data:', error);
        render();
      });
    })();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a9d6d39654745be',t:'MTc2NTA0MTM0Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>